---
title: "Trackman Report" 
subtitle: "Kyle Wood"
output:
  pdf_document:
    includes:
      keep_tex: yes 
      in_header: mystyles.tex
---

```{r echo=FALSE, out.width="25%", out.height="25%", fig.align='center'}
knitr::include_graphics("C:/Users/kyler/OneDrive/Documents/Projects/KsTrackmanApp/KsBannerLogo.png")
```


```{r setup, echo=FALSE, include=FALSE}
library(tinytex)
library(readr)
library(DBI)
library(RMySQL)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(ggforce)
library(knitr)
library(kableExtra)

knitr::opts_chunk$set(echo = FALSE, warning = FALSE)

db = dbConnect(MySQL(),
               user = 'kyle',
               password = 'pa$$word',
               host = 'localhost',
               dbname = 'trackman')

df <- dbReadTable(db, "pitching_data")
kw <- subset(df, Pitcher == "Wood, Kyle")

#strikezone coordinates
x <- c(-.95,.95,.95,-.95,-.95)
z <- c(1.6,1.6,4.0,4.0,1.6)

#store in dataframe
sz <- data.frame(x,z)

#calculate means and maxes of interested metrics
means <- df %>%
  group_by(Pitcher, TaggedPitchType) %>%
  summarise(across(c("RelSpeed", "SpinRate", "InducedVertBreak", "HorzBreak", "Extension", "VertApprAngle", "SpinAxis3dSpinEfficiency"), list(mean = mean, max = max)))


m <- subset(means, Pitcher == "Wood, Kyle")
m <- m[ -c(1,6,8,10,12,14,16)]
m <- m[order(m$RelSpeed_mean, decreasing=TRUE),]

```

```{r table, echo = FALSE, results='asis'}
table <- knitr::kable(m, "latex", digits = c(0, 1, 1, 0, 1, 1, 1, 1, 2), col.names = c('Pitch Type', 'Avg Velocity', ' Max Velocity','Spin Rate', 'IVB', 'HB', 'Extension', "VAA", "Spin Efficiency"), align = "c", caption = "Pitch Metrics")  %>% 
  row_spec(0, background = "#0080FF")

table <- kable_styling(table, full_width = FALSE, latex_options = "scale_down", position = "left")
cat(table)
```

<!-- You can also embed plots, for example: -->

```{r plots, echo=FALSE, out.width="50%", out.height="50%"}
ggplot(kw, aes(x = PlateLocSide, y = PlateLocHeight, color = TaggedPitchType)) + 
  geom_path(data = sz, aes(x = x, y = z), color = "black") +
  geom_point() +
  xlim(-5, 5) + ylim(0, 7) +
  coord_equal() +
  labs(title = "Pitch Location", subtitle = "From Pitcher View", x = "Horizontal Location", y = "Vertical Location") +
  theme_bw() +
  theme(legend.position = "bottom")


ggplot(kw, aes(x = RelSide, y = RelHeight, fill= TaggedPitchType, color = TaggedPitchType)) + 
    labs(title = "Release Point", subtitle = "From Pitcher View", x = "Release Side", y = "Release Height") + geom_point() + xlim(-3, 3) + ylim(0, 7) + theme(legend.position = "bottom") + theme_bw() + theme(legend.position = "bottom")

ggplot(kw,  aes(x = HorzBreak, y = InducedVertBreak, fill = TaggedPitchType, color = TaggedPitchType)) + 
  labs(title = "Pitch Movement", x = "Horizontal Break", y = "Induced Vertical Break") + 
  geom_point() + geom_mark_ellipse(expand = 0) + xlim(-20, 20) + ylim(-25, 25) + theme(legend.position = "bottom") + theme_bw() + theme(legend.position = "bottom")

ggplot(kw,  aes(x = SpinAxis, y = SpinAxis3dTransverseAngle, fill = TaggedPitchType, color = TaggedPitchType)) +
  labs(title = "Seam-Shifted Wake", x = "Observed Axis", y = "Inferred Axis") + geom_mark_ellipse(expand = 0) + geom_abline(slope=1, intercept=0) +geom_point() + geom_segment(xend = kw$SpinAxis, yend = kw$SpinAxis3dTransverseAngle) + xlim(0, 350) + ylim(0, 350) + theme_bw() + theme(legend.position = "bottom")

#Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot. -->
```